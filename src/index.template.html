<!DOCTYPE html>
<html>
    <head>
        <title>Swum</title>
        <meta charset="UTF-8">
        <meta name="author" content="Michael Gogins">
        <meta name="description" content="Visual music inspired by the interactive media works of Xiaohan Zhang.">
        <meta name="viewport" content="width=800, user-scalable=no">
        <title>Visual music by Michael Gogins</title>
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <script src="csound_samples.js"></script>
        <script src="CsoundAudioNode.js"></script>
        <script src="csound_loader.js"></script>
        <script src="silencio/js/Silencio.js"></script>
        <script src="silencio/js/ChordSpace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.1/dat.gui.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sprintf/1.1.1/sprintf.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/91/three.js"></script>
        <style>
            ::-webkit-scrollbar
            {
            width:10px;
            }
            ::-webkit-scrollbar-track-piece
            {
            background-color:transparent;
            }
            ::-webkit-scrollbar-corner
            {
            background-color:transparent;
            }
        .dg {
            font-family: Monaco, sans-serif;
            font-size:8pt;
            }
        </style>
    </head>
    <body style="background:black;">
        <table id = 'statistics' style="table-layout:fixed;z-order:10000;position:fixed;left:1vw;color:#eee;top:1vw;font-family:Monaco, sans-serif;font-size:8pt;">
            <col width=400px>
            <col width=208px>
            <tr style="color:gold;">
                <!-- Copyright (C) 2016 by Michael Gogins -->
                <td><b><i>Swum</i></b>, for Csound+HTML5</td>
                <td style="text-align:right;">Michael Gogins</td>
            <tr>
                <td colspan="2" style="color:gold;text-align:left">Click "Play"; if you don't hear sound, adjust "Master effects" group "gk_MasterOutput_level" slider and some instrument level sliders, click "Save", click "Revert."</td>
            </tr>
            </tr>
            <tr>
                <td>Time:</td>
                <td id="Time_cell" style="text-align:right;color:LawnGreen;font-weight:bold;">0</td>
            </tr>
            <tr>
                <td>Chord: </td>
                <td id="Chord_cell" style="color:SkyBlue;text-align:right;"></td>
            </tr>
            <tr>
                <td>Notes: </td>
                <td id="Notes_cell" style="color:SkyBlue;text-align:right;"></td>
            </tr>
            <tr id='messages'>
                <td colspan="2"><textarea id="console" style="width:100%;color:SkyBlue;background-color:transparent;border:none;text-align:left;height:200px;overflow:auto;padding:0;margin:0;border-collapse:collapse;font-family:Courier, sans-serif;font-size:8pt;"></textarea></td>
            </tr>
        </table>
        <textarea class="code" id="csd" hidden rows=24 cols=80>
<CsoundSynthesizer>
<CsLicense>
Copyright (C) 2013 by Michael Gogins.
All rights reserved.
</CsLicense>
<CsOptions>
-odac -m3 -d
</CsOptions>
<CsInstruments>
sr = 48000
ksmps = 100
nchnls = 2
0dbfs = 5000000

gkslider1 init 0
gkslider2 init 0
gkslider3 init 0
gkslider4 init 0
gkslider5 init 0
gkbutt1 init 0
gkbutt2 init 0
gkbutt3 init 0
gkbutt4 init 0
gkbutt5 init 0
gktrackpadx init 0
gktrackpady init 0
gkaccelerometerx init 0
gkaccelerometery init 0
gkaccelerometerz init 0

connect "Bower", "outleft", "ReverbLeft", "inleft"
connect "Bower", "outright", "ReverbRight", "inright"
connect "Phaser", "outleft", "ReverbLeft", "inleft"
connect "Phaser", "outright", "ReverbRight", "inright"
connect "Droner", "outleft", "ReverbLeft", "inleft"
connect "Droner", "outright", "ReverbRight", "inright"
connect "Sweeper", "outleft", "ReverbLeft", "inleft"
connect "Sweeper", "outright", "ReverbRight", "inright"
connect "Buzzer", "outleft", "ReverbLeft", "inleft"
connect "Buzzer", "outright", "ReverbRight", "inright"
connect "Blower", "outleft", "ReverbLeft", "inleft"
connect "Blower", "outright", "ReverbRight", "inright"
connect "Shiner", "outleft", "ReverbLeft", "inleft"
connect "Shiner", "outright", "ReverbRight", "inright"
; connect "ReverbLeft", "outleft", "ParametricEQ", "inleft"
; connect "ReverbRight", "outright", "ParametricEQ", "inright"
; connect "ParametricEQ", "outleft", "MasterOutput", "inleft"
; connect "ParametricEQ", "outright", "MasterOutput", "inright"
connect "ReverbLeft", "outleft", "MasterOutput", "inleft"
connect "ReverbRight", "outright", "MasterOutput", "inright"

alwayson "Controls"
alwayson "VariablesForControls"
alwayson "ReverbLeft"
alwayson "ReverbRight"
alwayson "ParametricEQ"
alwayson "MasterOutput"

opcode ratio2midinn, i, iii
ifundamental, inumerator, idenominator xin
ihertz = ifundamental * inumerator / idenominator
; print ihertz
; m = 12*log2(fm/440 Hz) + 69
ilog2 = log(2)
imidinn = 12 * (log(ihertz / 440) / ilog2) + 69
; print imidinn
xout imidinn
endop

instr 101
iinsno = p1
istart = p2
iduration = p3
ifundamental = p4
inumerator = p5
idenominator = p6
ivelocity = p7
ipan = p8
iratio = inumerator / idenominator
ihertz = ifundamental * iratio
ikey ratio2midinn ifundamental, inumerator, idenominator
event_i "i", "Droner", 0, iduration, ikey, ivelocity, 0, ipan
endin

instr 102
iinsno = p1
istart = p2
iduration = p3
ifundamental = p4
inumerator = p5
idenominator = p6
ivelocity = p7
ipan = p8
iratio = inumerator / idenominator
ihertz = ifundamental * iratio
ikey ratio2midinn ifundamental, inumerator, idenominator
event_i "i", "Phaser", 0, iduration, ikey, ivelocity, 0, ipan
endin

instr 103
iinsno = p1
istart = p2
iduration = p3
ifundamental = p4
inumerator = p5
idenominator = p6
ivelocity = p7
ipan = p8
iratio = inumerator / idenominator
ihertz = ifundamental * iratio
ikey ratio2midinn ifundamental, inumerator, idenominator
event_i "i", "Droner", 0, iduration, ikey, ivelocity, 0, ipan
endin

instr 104
iinsno = p1
istart = p2
iduration = p3
ifundamental = p4
inumerator = p5
idenominator = p6
ivelocity = p7
ipan = p8
iratio = inumerator / idenominator
ihertz = ifundamental * iratio
ikey ratio2midinn ifundamental, inumerator, idenominator
event_i "i", "Blower", 0, iduration, ikey, ivelocity, 0, ipan
endin

gioverlap = 20

gkDistortFactor init 0.4
gkFirstHarmonic init 0.4
instr Droner
iinsno = p1
istart = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p6
ipan = p7
print iinsno, istart, iduration, ikey, ivelocity, iphase, ipan
k1 init .5
k2 init .05
k3 init .1
k4 init .2
k5 init .1
k6 init .05
k7 init .1
k8 init 0
k9 init 0
k10 init 0
k3 = gkslider1
k4 = gkslider2
k5 = gkslider3
k6 = gkslider4
k7 = gkslider5
kwaveform init 0
iamp = ampdb(ivelocity)
iattack = gioverlap
idecay = gioverlap
isustain = p3 - gioverlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
print ihertz
isine ftgenonce 0, 0, 65536, 10, 1, 0, .02
if kwaveform == 0 then
asignal poscil3 1, ihertz, isine
endif
if kwaveform == 1 then
asignal vco2 1, ihertz, 8 ; integrated saw
endif
if kwaveform == 2 then
asignal vco2 1, ihertz, 12 ; triangle
endif
asignal chebyshevpoly asignal, 0, k1, k2, k3, k4, k5, k6, k7, k8, k9, k10
asignal = asignal * kenvelope * 10
aleft, aright pan2 asignal, ipan
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
aleft = adamping * aleft
aright = adamping * aright
outleta "outleft", aleft
outleta "outright", aright
endin

instr Bower
iinsno = p1
istart = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p6
ipan = p7
print iinsno, istart, iduration, ikey, ivelocity, iphase, ipan
iamp = ampdb(ivelocity) * 200
iattack = gioverlap
idecay = gioverlap
isustain = p3 - gioverlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
kamp = kenvelope
kfreq = ihertz
kpres = 0.25
; krat rspline 0.006,0.988,0.1,0.4
krat rspline 0.006,0.988,1,4
kvibf = 4.5
kvibamp = 0
iminfreq = 20
isine ftgenonce 0,0,65536,10,1
aSig wgbow kamp,kfreq,kpres,krat,kvibf,kvibamp,isine,iminfreq
;aSig butlp aSig,2000
;aSig pareq aSig,80,6,0.707
aleft, aright pan2 aSig / 7, ipan
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
aleft = adamping * aleft
aright = adamping * aright
outleta "outleft", aleft
outleta "outright", aright
endin

gkratio1 = 1
gkratio2 = 1/3
gkindex1 = 1
gkindex2 = 0.0125
instr Phaser
iinsno = p1
istart = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p6
ipan = p7
print iinsno, istart, iduration, ikey, ivelocity, iphase, ipan
iamp = ampdb(ivelocity) * 12
iattack = gioverlap
idecay = gioverlap
isustain = p3 - gioverlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
isine ftgenonce 0,0,65536,10,1
khertz = ihertz
ifunction1 = isine
ifunction2 = isine
a1,a2 crosspm gkratio1, gkratio2, gkindex1, gkindex2, khertz, ifunction1, ifunction2
aleft, aright pan2 a1+a2, ipan
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
aleft = adamping * aleft * kenvelope
aright = adamping * aright * kenvelope
outleta "outleft", aleft
outleta "outright", aright
endin

gkbritel init 0
gkbriteh init 2.9
gkbritels init .2 / 3
gkbritehs init 2.5 / 2
instr Sweeper
iinsno = p1
istart = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p6
ipan = p7
print iinsno, istart, iduration, ikey, ivelocity, iphase, ipan
iamp = ampdb(ivelocity)
gisine ftgenonce 0, 0, 65536, 10, 1
gioctfn ftgenonce 0, 0, 65536, -19, 1, 0.5, 270, 0.5
iattack = gioverlap
idecay = gioverlap
isustain = p3 - gioverlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
icps = ihertz
kamp expseg 0.001,0.02,0.2,p3-0.01,0.001
ktonemoddep jspline 0.01,0.05,0.2
ktonemodrte jspline 6,0.1,0.2
ktone poscil3 ktonemoddep, ktonemodrte, gisine
kbrite rspline gkbritel, gkbriteh, gkbritels, gkbritehs
ibasfreq init icps
ioctcnt init 3
iphs init 0
;a1 hsboscil kamp, ktone, kbrite, ibasfreq, gisine, gioctfn, ioctcnt, iphs
a1 hsboscil kenvelope, ktone, kbrite, ibasfreq, gisine, gioctfn, ioctcnt, iphs
amod poscil3 0.25, ibasfreq*(1/3), gisine
arm = a1*amod
kmix expseg 0.001, 0.01, rnd(1), rnd(3)+0.3, 0.001
kmix=.25
a1 ntrpol a1, arm, kmix
;a1 pareq a1/10, 400, 15, .707
;a1 tone a1, 500
kpanrte jspline 5, 0.05, 0.1
kpandep jspline 0.9, 0.2, 0.4
kpan poscil3 kpandep, kpanrte, gisine
a1,a2 pan2 a1, kpan
a1 delay a1, rnd(0.1)
a2 delay a2, rnd(0.11)
kenv linsegr 1, 1, 0
kenv = kenvelope
aleft = a1*kenv*.02
aright = a2*kenv*.02
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
aleft = adamping * aleft
aright = adamping * aright
outleta "outleft", aleft
outleta "outright", aright
endin

instr Buzzer
iinsno = p1
istart = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p6
ipan = p7
print iinsno, istart, iduration, ikey, ivelocity, iphase, ipan
iamp = ampdb(ivelocity) * 4
iattack = gioverlap
idecay = gioverlap
isustain = p3 - gioverlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
;asignal gbuzz kenvelope, ihertz, 3, gkFirstHarmonic, gkDistortFactor, gisine
isine ftgenonce 0, 0, 65536, 10, 1
gkHarmonics = gkslider1 * 20
asignal buzz kenvelope, ihertz, gkHarmonics, isine
asignal = asignal * 3
;asignal vco2 kenvelope, ihertz, 12
;asignal poscil3 kenvelope, ihertz, giharmonics
;asignal distort asignal, gkDistortFactor * .4, giwaveshaping
aleft, aright pan2 asignal, ipan
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
aleft = adamping * aleft
aright = adamping * aright
outleta "outleft", aleft
outleta "outright", aright
endin

instr Shiner
iinsno = p1
istart = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p6
ipan = p7
print iinsno, istart, iduration, ikey, ivelocity, iphase, ipan
iamp = ampdb(ivelocity) * 4
iattack = gioverlap
idecay = gioverlap
isustain = p3 - gioverlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
;asignal gbuzz kenvelope, ihertz, 3, gkFirstHarmonic, gkDistortFactor, gisine
gkHarmonics = gkslider1 * 20
;asignal buzz kenvelope, ihertz, gkHarmonics, gisine
;asignal = asignal
asignal vco2 kenvelope * 4, ihertz, 12
;asignal poscil3 kenvelope, ihertz, giharmonics
;asignal distort asignal, gkDistortFactor * .4, giwaveshaping
aleft, aright pan2 asignal, ipan
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
aleft = adamping * aleft
aright = adamping * aright
outleta "outleft", aleft
outleta "outright", aright
endin

gkgrainDensity init 150
gkgrainDuration init 0.2
gkgrainAmplitudeRange init 100
gkgrainFrequencyRange init .033
instr Blower
 //////////////////////////////////////////////
 // Original by Hans Mikelson.
 // Adapted by Michael Gogins.
 //////////////////////////////////////////////
 pset 0, 0, 3600
i_instrument = p1
i_time = p2
i_duration = p3
i_midikey = p4
i_midivelocity = p5
i_phase = p6
i_pan = p6
i_depth = p8
i_height = p9
i_pitchclassset = p10
i_homogeneity = p11
ifrequency = cpsmidinn(i_midikey)
iamplitude = ampdb(i_midivelocity) / 200
 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 ; f1 0 65536 1 "hahaha.aif" 0 4 0
 ; f2 0 1024 7 0 224 1 800 0
 ; f3 0 8192 7 1 8192 -1
 ; f4 0 1024 7 0 512 1 512 0
 ; f5 0 1024 10 1 .3 .1 0 .2 .02 0 .1 .04
 ; f6 0 1024 10 1 0 .5 0 .33 0 .25 0 .2 0 .167
 ; a0 14 50
 ; p1 p2 p3 p4 p5 p6 p7 p8 p9 p10
 ; Start Dur Amp Freq GrTab WinTab FqcRng Dens Fade
 ; i1 0.0 6.5 700 9.00 5 4 .210 200 1.8
 ; i1 3.2 3.5 800 7.08 . 4 .042 100 0.8
 ; i1 5.1 5.2 600 7.10 . 4 .0320 100 0.9
 ; i1 7.2 6.6 900 8.03 . 4 .021 150 1.6
 ; i1 21.3 4.5 1000 9.00 . 4 .031 150 1.2
 ; i1 26.5 13.5 1100 6.09 . 4 .121 150 1.5
 ; i1 30.7 9.3 900 8.05 . 4 .014 150 2.5
 ; i1 34.2 8.8 700 10.02 . 4 .14 150 1.6
igrtab ftgenonce 0, 0, 65536, 10, 1, .3, .1, 0, .2, .02, 0, .1, .04
iwintab ftgenonce 0, 0, 65536, 10, 1, 0, .5, 0, .33, 0, .25, 0, .2, 0, .167
iHz = ifrequency
ip4 = iamplitude
ip5 = iHz
ip6 = igrtab
ip7 = iwintab
ip8 = 0.033
ip8 = .002
ip9 = 150
ip9 = 100
ip10 = 1.6
ip10 = 3
idur = p3
iamp = iamplitude ; p4
ifqc = iHz ; cpspch(p5)
igrtab = ip6
iwintab = ip7
ifrng = ip8
idens = ip9
ifade = ip10
igdur = 0.2
iattack = gioverlap
idecay = gioverlap
isustain = p3 - gioverlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
; kamp linseg 0, ifade, 1, idur - 2 * ifade, 1, ifade, 0
kamp = kenvelope
; Amp Fqc Dense AmpOff PitchOff GrDur GrTable WinTable MaxGrDur
aoutl grain ip4, ifqc, gkgrainDensity, gkgrainAmplitudeRange, ifqc * gkgrainFrequencyRange, gkgrainDuration, igrtab, iwintab, 5
aoutr grain ip4, ifqc, gkgrainDensity, gkgrainAmplitudeRange, ifqc * gkgrainFrequencyRange, gkgrainDuration, igrtab, iwintab, 5
aleft = aoutl * kamp * iamplitude
aright = aoutr * kamp * iamplitude
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
aleft = adamping * aleft
aright = adamping * aright
outleta "outleft", aleft
outleta "outright", aright
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gkReverbFeedback init 0.975
gkDelayModulation init 0.875


instr ReverbLeft
aleft init 0
azero init 0
aleft inleta "inleft"
aleft, aright reverbsc aleft, azero, gkReverbFeedback, 15000.
outleta "outleft", aleft
endin

instr ReverbRight
aleft init 0
azero init 0
aright inleta "inright"
aleft, aright reverbsc azero, aright, gkReverbFeedback, 15000.0
outleta "outright", aright
endin

gkCenterHz init 200
gkGain init 1
gkQ init 0.7071067 ; sqrt(.5)
instr ParametricEQ
aleft inleta "inleft"
aright inleta "inright"
aleft pareq aleft, gkCenterHz, ampdb(gkGain), gkQ, 0
aright pareq aright, gkCenterHz, ampdb(gkGain), gkQ, 0
outleta "outleft", aleft
outleta "outright", aright
endin

gkMasterLevel init 4
instr MasterOutput
aleft inleta "inleft"
aright inleta "inright"
aleft *= gkMasterLevel
aright *= gkMasterLevel
outs aleft, aright
;fout "Drone-IV-performance.wav", 16, aleft, aright
endin

instr Controls
gkslider1 chnget "slider1"
gkslider2 chnget "slider2"
gkslider3 chnget "slider3"
gkslider4 chnget "slider4"
gkslider5 chnget "slider5"
gkbutt1 chnget "butt1"
gkbutt2 chnget "butt2"
gkbutt3 chnget "butt3"
gkbutt4 chnget "butt4"
gkbutt5 chnget "butt5"
gktrackpadx chnget "trackpad.x"
gktrackpady chnget "trackpad.y"
gkaccelerometerx chnget "accelerometerX"
gkaccelerometery chnget "accelerometerY"
gkaccelerometerz chnget "accelerometerZ"
endin

instr VariablesForControls
if gkslider1 > 0 then
 	gkFirstHarmonic = gkslider1 * 2
	gkgrainDensity = gkslider1 * 400
	gkratio2 = gkslider1 ;1/3
endif
if gkslider2 > 0 then
 	gkDistortFactor = gkslider2 * 2
	gkgrainDuration = 0.005 + gkslider2 / 2
	gkindex1 = gkslider2 * 3;1
endif
if gkslider3 > 0 then
 	gkVolume = gkslider3 * 5
	gkgrainAmplitudeRange = gkslider3 * 300
	gkindex2 = gkslider3 ;0.0125
endif
if gkslider4 > 0 then
	gkgrainFrequencyRange = gkslider4 / 10
endif
if gktrackpady > 0 then
 	gkDelayModulation = gktrackpady * 2
 	; gkGain = gktrackpady * 2 - 1
endif
if gktrackpadx > 0 then
 	gkReverbFeedback = (2/3) + (gktrackpadx / 3)
 	; gkCenterHz = 100 + gktrackpadx * 3000
endif
kbutt1 trigger gkbutt1, .5, 0
if kbutt1 > 0 then
 	gkbritels = gkbritels / 1.5
 	gkbritehs = gkbritehs / 1.5
 	; gkQ = gkQ / 2
endif
kbutt2 trigger gkbutt2, .5, 0
if kbutt2 > 0 then
 	gkbritels = gkbritels * 1.5
 	gkbritehs = gkbritehs * 1.5
 	; gkQ = gkQ * 2
endif

endin

</CsInstruments>
<CsScore>

f 0 360

</CsScore>
</CsoundSynthesizer>
   </textarea>
    <script>
        var gui = null;
        var score_time_started = 0.;
        var score_time = 0.;
        var chord = new ChordSpace.Chord([36, 48, 55, 59, 64]);
        var modality = chord.clone();
        console.log(chord.information());
        var do_voiceleading = false;
        var prior_chord = chord.clone();
        function csoundMessage(text) {
            var Log_cell = document.getElementById('console');
            Log_cell.value += text;
            Log_cell.scrollTop = Log_cell.scrollHeight;
         }
        function updateTimeCell() {
            var score_time_cell = document.getElementById('Time_cell');
            if (typeof csound === 'undefined') {
                return;
            }
            if (csound === null) {
                return;
            }
            score_time = score_time_started - (new Date().getTime() / 1000);
            score_time_cell.innerHTML = score_time.toFixed(4);
            setTimeout(updateTimeCell, 1000);
        };
        var parameters = {
            gk_Bower_pressure: 0.25,
            gk_Bower_level: 0.5,
            gk_Blower_grainDensity: .150,
            gk_Blower_grainDuration: .2,
            gk_Blower_grainAmplitudeRange: .1,
            gk_Blower_grainFrequencyRange: .033,
            gk_Blower_level: 0.5,
            gk_Buzzer_Harmonics: 15,
            gk_Buzzer_level: 0.5,
            gk_Droner_partial1: 0.1,
            gk_Droner_partial2: 0.1,
            gk_Droner_partial3: 0.1,
            gk_Droner_partial4: 0.1,
            gk_Droner_partial5: 0.1,
            gk_Droner_level: 0.5,
            gk_Harpsichord_level: 0.5,
            gk_Harpsichord_pick: .75,
            gk_Harpsichord_reflection: .5,
            gk_Harpsichord_pluck: .75,
            gk_Phaser_ratio1: 1,
            gk_Phaser_ratio2: .3333334,
            gk_Phaser_index1: 1,
            gk_Phaser_index2: .0125,
            gk_Phaser_level: 0.5,
            gk_Shiner_level: 0.5,
            gk_Sweeper_britel: 0,
            gk_Sweeper_briteh: 2.9,
            gk_Sweeper_britels: .2 / 3,
            gk_Sweeper_britehs: 2.5 / 2,
            gk_Sweeper_level: 0.5,
            gk_Xing_level: 0.5,
            gk_YiString_reverb_send: 0.5,
            gk_YiString_chorus_send: 0.5,
            gk_YiString_level: 0.5,
            gk_SolinaChorus_chorus_lfo1_hz: 18,
            gk_SolinaChorus_chorus_lfo1_amp: .6,
            gk_SolinaChorus_chorus_lfo2_hz: 6,
            gk_SolinaChorus_chorus_lfo2_amp: .2,
            gk_Reverb_feedback: .975,
            gk_Reverb2_Feedback: .7,
            gk_MasterOutput_level: .4,
            gk_FM_Clang_preset: 1,
            gk_FM_Clang_level: 0,
            Play: function() {
                try {
                    csound = get_csound(csoundMessage);
                    if (csound_audio_node === null) {
                         return;
                    }
                    gui.revert();
                    let csd = document.getElementById('csd').value;
                    csound.Stop();
                    csound.SetOption("-odac")
                    csound.SetOption("--ksmps=128")
                    csound.SetOption("--nchnls=2")
                    csound.SetOption("--nchnls_i=1")
                    csound.SetOption("--sample-rate=44100")
                    csound.CompileCsdText(csd);
                    csound.Start();
                    csound.Perform();
                    score_time_started = new Date().getTime() / 1000;
                    setTimeout(updateTimeCell, 0);
                } catch (e) {
                    alert(e);
                }
            },
            Stop: function() {
                csound.Stop();
            },
            Close: function() {
                try {
                    csound.Stop();
                    window.close();
                } catch (e) {
                    console.log(e);
                }
            },
            Hide: function() {
                $("#dat_gui").toggle();
                $("#statistics").toggle();
            },
            PlayChord: function() {
            },
            PlayChordWithVoiceleading: function() {
            },
        };        
        window.onload = function() {
            gui = new dat.GUI({width: 300});
            gui.remember(parameters);
            gui.add(parameters, 'Play').name('Play [Ctrl-P]');
            gui.add(parameters, 'Stop').name('Stop [Ctrl-S]');
            gui.add(parameters, 'Close').name('Close').name('Exit [Ctrl-X]');
            var Master = gui.addFolder('Master effects');
            add_slider(Master, 'gk_Reverb_feedback', 0, 1);
            add_slider(Master, 'gk_Reverb2_Feedback', 0, 1);
            add_slider(Master, 'gk_MasterOutput_level', -80, 80);
            var intruments = gui.addFolder('Instruments');
            var fmclang = intruments.addFolder('FM Clang');
            add_slider(fmclang, 'gk_FM_Clang_preset', 1, 13);
            add_slider(fmclang, 'gk_FM_Clang_level', -80, 80);
            var Blower = intruments.addFolder('Blower');
            add_slider(Blower, 'gk_Blower_grainDensity', 0, 400);
            add_slider(Blower, 'gk_Blower_grainDuration', 0, .5);
            add_slider(Blower, 'gk_Blower_grainAmplitudeRange', 0, 400);
            add_slider(Blower, 'gk_Blower_grainFrequencyRange', 0, 100);
            add_slider(Blower, 'gk_Blower_level', -80, 80);
            var Bower = intruments.addFolder('Bower');
            add_slider(Bower, 'gk_Bower_pressure', 0, 1);
            add_slider(Bower, 'gk_Bower_level', -80, 80);
            var Buzzer = intruments.addFolder('Buzzer');
            add_slider(Buzzer, 'gk_Buzzer_Harmonics', 0, 20);
            add_slider(Buzzer, 'gk_Buzzer_level', -80, 80);
            var Droner = intruments.addFolder('Droner');
            add_slider(Droner, 'gk_Droner_partial1', 0, 1);
            add_slider(Droner, 'gk_Droner_partial2', 0, 1);
            add_slider(Droner, 'gk_Droner_partial3', 0, 1);
            add_slider(Droner, 'gk_Droner_partial4', 0, 1);
            add_slider(Droner, 'gk_Droner_partial5', 0, 1);
            add_slider(Droner, 'gk_Droner_level', -80, 80);
            var Harpsichord = intruments.addFolder('Harpsichord');
            add_slider(Harpsichord, 'gk_Harpsichord_level', -80, 80);
            var Phaser = intruments.addFolder('Phaser');
            add_slider(Phaser, 'gk_Phaser_ratio1', 0, 2);
            add_slider(Phaser, 'gk_Phaser_ratio2', 0, 2);
            add_slider(Phaser, 'gk_Phaser_index1', 0, 1);
            add_slider(Phaser, 'gk_Phaser_index2', 0, 1);
            add_slider(Phaser, 'gk_Phaser_level', -80, 80);
            var Xing = intruments.addFolder('Xing');
            add_slider(Xing, 'gk_Xing_level', -80, 80);
            var Shiner = intruments.addFolder('Shiner');
            add_slider(Shiner, 'gk_Shiner_level', -80, 80);
            var Sweeper = intruments.addFolder('Sweeper');
            add_slider(Sweeper, 'gk_Sweeper_britel', 0, 4);
            add_slider(Sweeper, 'gk_Sweeper_briteh', 0, 4);
            add_slider(Sweeper, 'gk_Sweeper_britels', 0, 4);
            add_slider(Sweeper, 'gk_Sweeper_britehs', 0, 4);
            add_slider(Sweeper, 'gk_Sweeper_level', -80, 80);
            gui.revert();
            gui.domElement.id = 'dat_gui';
            //gui.id = "dat_gui";
            //flame.resize();
            //div = document.getElementById('root');
            //div.style.zIndex = -100;
        }
        function gk_update(name, value) {
            if (csound !== null) {
                var numberValue = parseFloat(value);
                csound.SetControlChannel(name, numberValue);
                csound.Message(name + ': ' + numberValue + '\n');
            }
        }
        function add_slider(gui_folder, token, minimum, maximum) {
            var on_parameter_change = function(value) {
                if (token.startsWith('gk_')) {
                    gk_update(token, value);
                } 
            };
            var slider = gui_folder.add(parameters, token, minimum, maximum);
            slider.onChange(on_parameter_change);
            return slider;
        };
        function logMessage(message) {
            console.log(message);
            var messages_textarea = document.getElementById("console");
            var existing = messages_textarea.value;
            messages_textarea.value = existing + message.data;
            messages_textarea.scrollTop = messages_textarea.scrollHeight;
        }
        // Used to find out what actually happens when a key is pressed.
        function printKey(e) {
          e = e || event
          //if (document.forms.keyform[e.type + 'Ignore'].checked) return
          var evt = e.type
          while (evt.length < 10) evt += ' ';
          var data = evt +
            ' keyCode=' + e.keyCode +
            ' which=' + e.which +
            ' charCode=' + e.charCode +
            ' char=' + String.fromCharCode(e.keyCode || e.charCode) +
            (e.shiftKey ? ' +shift' : '') +
            (e.ctrlKey ? ' +ctrl' : '') +
            (e.altKey ? ' +alt' : '') +
            (e.metaKey ? ' +meta' : '') + '\n';

          var message = {data: data};
          logMessage(message);
        }
        $(document).on("keydown", function (e) {
            //printKey(e);
            e.preventDefault();
            e.stopPropagation();
            var e_char = String.fromCharCode(e.keyCode || e.charCode);
            // Numbers (and pitch-classes) are 0 through b.
            // Shift key changes from 1 to -1.
            let sign;
            if (e.shiftKey === true) {
                sign = -1;
            } else {
                sign = 1;
            }
            let value;
            value = e.which - 48;
            if (value > 9) {
                value -= 7;
            }
            value *= sign;
            console.log('value:' + value);
            if (e.ctrlKey === true) {
                if        (e_char === 'V') {
                    parameters.Hide();
                } else if (e_char === 'K') {
                    chord = chord.K(modality);
                } else if (e_char === 'P') {
                    parameters.Play();
                } else if (e_char === 'S') {
                    parameters.Stop();
                } else if (e_char === 'X') {
                    parameters.Close();
                } else if (e_char === 'C') {
                    parameters.PlayChord();
                }
            } else if (e.altKey === true) {
                
            } else {
            }
        });
        </script>
    </body>
</html>        
